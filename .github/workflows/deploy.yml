name: Deploy to Hostinger

on:
  push:
    branches:
      - main  # Pastikan ini sesuai nama branch utama Anda (main atau master)

jobs:
  FTP-Deploy-Action:
    name: ðŸŽ‰ Deploy Process
    runs-on: ubuntu-latest
    steps:
    
    # 1. Ambil kode terbaru
    - name: ðŸšš Get latest code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # 2. Setup PHP
    - name: ðŸ”§ Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2'
        extensions: mbstring, xml, ctype, iconv, intl, pdo, pdo_mysql, dom, filter, gd, iconv, json, mbstring, zip

    # 3. Install Composer dependencies
    - name: ðŸ“¦ Install Composer dependencies
      run: |
        composer install --no-interaction --prefer-dist --optimize-autoloader --no-dev

    # 4. Install NPM dependencies
    - name: ðŸ“¦ Install NPM dependencies
      run: |
        npm ci

    # 5. Build assets
    - name: ðŸ”¨ Build assets
      run: |
        npm run build

    # 6. Kirim ke Hostinger via FTP
    # ... langkah sebelumnya sama ...

    # 6. Kirim ke Hostinger via FTP
    - name: ðŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      with:
        server: ${{ secrets.IP }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        
        # PERBAIKAN 1: Arahkan ke folder spesifik domain
        server-dir: /domains/posyandukaranggan.com/public_html/

        port: 21
        protocol: ftp
        timeout: 60000
        
        exclude: |
          **/.git*
          **/.git*/**
          **/.github/**
          **/node_modules/**
          **/.env
          **/.env.*
          **/README.md