name: Deploy to Hostinger

on:
  push:
    branches:
      - main  # Pastikan ini sesuai nama branch utama Anda (main atau master)

jobs:
  FTP-Deploy-Action:
    name: ðŸŽ‰ Deploy Process
    runs-on: ubuntu-latest
    steps:
    
    # 1. Ambil kode terbaru
    - name: ðŸšš Get latest code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # 2. Setup PHP
    - name: ðŸ”§ Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2'
        extensions: mbstring, xml, ctype, iconv, intl, pdo, pdo_mysql, dom, filter, gd, iconv, json, mbstring, zip

    # 3. Install Composer dependencies
    - name: ðŸ“¦ Install Composer dependencies
      run: |
        composer install --no-interaction --prefer-dist --optimize-autoloader --no-dev

    # 4. Install NPM dependencies
    - name: ðŸ“¦ Install NPM dependencies
      run: |
        npm ci

    # 5. Build assets
    - name: ðŸ”¨ Build assets
      run: |
        npm run build

    # 6. Kirim ke Hostinger via FTP
    - name: ðŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      with:
        server: ${{ secrets.IP }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        
        # PENTING UNTUK HOSTINGER:
        # Hostinger biasanya mengunci akun FTP langsung di dalam folder public_html
        # Jadi arahkan ke root (./)
        server-dir: ./
        
        # Mencegah file sampah atau file rahasia ter-upload
        exclude: |
          **/.git*
          **/.git*/**
          **/.github/**
          **/node_modules/**
          **/tests/**
          **/.editorconfig
          **/.gitattributes
          **/.gitignore
          **/.env
          **/.env.*
          **/README.md
          **/phpunit.xml
          **/postcss.config.js
          **/tailwind.config.js
          **/vite.config.js
          **/package.json
          **/package-lock.json
          **/composer.json
          **/composer.lock
          **/storage/logs/**
          **/storage/framework/cache/**
          **/storage/framework/sessions/**
          **/storage/framework/views/**
          **/bootstrap/cache/**
          **/database/**
          **/public/Login_v1/**
